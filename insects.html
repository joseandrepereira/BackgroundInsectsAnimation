<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insetos Animados</title>
    <style>
        body {
            background-color: #000000;
            padding: 0;
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 2;
            color: white;
            font-family: Arial, sans-serif;
        }

        input[type="range"] {
            width: 200px;
        }
    </style>
</head>

<body>
    <canvas id='world'></canvas>

    <div class="controls">
        <label for="insectRange">Quantidade de Insetos: </label>
        <input type="range" id="insectRange" min="1" max="50" value="1">
        <span id="insectCount">1</span>
    </div>

    <script>
        var SCREEN_WIDTH = window.innerWidth;
        var SCREEN_HEIGHT = window.innerHeight;
        var QUANTITY = 1;
        var canvas, context, particles = [];
        var mouseX = SCREEN_WIDTH * 0.5;
        var mouseY = SCREEN_HEIGHT * 0.5;

        function init() {
            canvas = document.getElementById('world');
            if (canvas && canvas.getContext) {
                context = canvas.getContext('2d');
                window.addEventListener('mousemove', documentMouseMoveHandler, false);
                window.addEventListener('resize', windowResizeHandler, false);
                createParticles();
                windowResizeHandler();
                setInterval(loop, 1000 / 60);

                document.getElementById('insectRange').addEventListener('input', function (e) {
                    var newQuantity = parseInt(e.target.value);
                    document.getElementById('insectCount').textContent = newQuantity;
                    adjustParticles(newQuantity);
                });
            }
        }

        function createParticles() {
            var colors = ["rgba(255, 99, 71, 0.7)", "rgba(255, 165, 0, 0.7)", "rgba(34, 193, 195, 0.7)", "rgba(253, 29, 29, 0.7)", "rgba(131, 58, 180, 0.7)", "rgba(0, 255, 255, 0.7)"];
            for (var i = 0; i < QUANTITY; i++) {
                particles.push({
                    size: 5,
                    position: { x: SCREEN_WIDTH - 50, y: SCREEN_HEIGHT + 10 }, // Inicia fora da tela, na parte inferior direita
                    shift: { x: SCREEN_WIDTH - 50, y: SCREEN_HEIGHT + 10 },
                    speed: 0.01 + Math.random() * 0.02, // Reduzindo a velocidade de movimento
                    orbit: 30 + Math.random() * 20,
                    angle: Math.random() * Math.PI * 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    rotationSpeed: 0.01 + Math.random() * 0.02,
                    rotationDirection: Math.random() > 0.5 ? 1 : -1
                });
            }
        }

        function adjustParticles(newQuantity) {
            if (newQuantity > particles.length) {
                // Adiciona novos insetos
                for (var i = particles.length; i < newQuantity; i++) {
                    createParticles();
                }
            } else if (newQuantity < particles.length) {
                // Remove os insetos extras
                var excessParticles = particles.splice(newQuantity);
                excessParticles.forEach(function (p) {
                    removeParticle(p);
                });
            }
        }

        function removeParticle(particle) {
            particle.shift.x += (SCREEN_WIDTH - 50 - particle.shift.x) * 0.05; // Move para a parte de baixo direita
            particle.shift.y += (SCREEN_HEIGHT + 10 - particle.shift.y) * 0.05;
            setTimeout(function () {
                var index = particles.indexOf(particle);
                if (index > -1) {
                    particles.splice(index, 1);
                }
            }, 1000); // Remover do array após o tempo de animação
        }

        function documentMouseMoveHandler(event) {
            mouseX = event.clientX;
            mouseY = event.clientY;
        }

        function windowResizeHandler() {
            SCREEN_WIDTH = window.innerWidth;
            SCREEN_HEIGHT = window.innerHeight;
            canvas.width = SCREEN_WIDTH;
            canvas.height = SCREEN_HEIGHT;
        }

        function leaveFootprint(x, y, color) {
            let footprint = document.createElement("div");
            footprint.style.position = "absolute";
            footprint.style.left = x + "px";
            footprint.style.top = y + "px";
            footprint.style.width = "8px";
            footprint.style.height = "12px";
            footprint.style.background = color;
            footprint.style.borderRadius = "50%";
            footprint.style.transform = `rotate(${Math.random() * 360}deg)`;
            document.body.appendChild(footprint);
            setTimeout(() => document.body.removeChild(footprint), 3000);
        }

        function loop() {
            context.clearRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];

                // Movendo os insetos lentamente em direção ao ponto de entrada
                p.shift.x += (mouseX - p.shift.x) * p.speed;
                p.shift.y += (mouseY - p.shift.y) * p.speed;

                p.angle += p.speed;
                p.position.x = p.shift.x + Math.cos(p.angle) * p.orbit;
                p.position.y = p.shift.y + Math.sin(p.angle) * p.orbit;

                p.rotationDirection = p.rotationDirection === 1 ? 1 : -1;
                p.angle += p.rotationSpeed * p.rotationDirection;

                context.fillStyle = p.color;
                context.beginPath();
                context.arc(p.position.x, p.position.y, p.size, 0, Math.PI * 2, true);
                context.fill();
                drawLegs(p.position.x, p.position.y);

                if (Math.random() < 0.05) {
                    leaveFootprint(p.position.x, p.position.y, p.color);
                }
            }
        }

        function drawLegs(x, y) {
            context.strokeStyle = "#552200";
            context.lineWidth = 2;
            context.beginPath();
            for (let i = 0; i < 6; i++) {
                let angle = (Math.PI / 3) * i;
                let legX = x + Math.cos(angle) * 10;
                let legY = y + Math.sin(angle) * 10;
                context.moveTo(x, y);
                context.lineTo(legX, legY);
            }
            context.stroke();
        }

        window.onload = init;
    </script>
</body>

</html>
